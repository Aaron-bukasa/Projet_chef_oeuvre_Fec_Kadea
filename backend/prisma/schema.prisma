generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// DEFINITION DES MODELES

// DEMANDE ET SUIVI DEMANDE

model Demande {
  id                Int         @id @default(autoincrement())
  nom               String
  email             String      @unique
  telephone         String      @unique
  nom_organisation      String
  forme_juridique   String
  statut            String      @default("en attente")  // en attente, validée, rejetée
  date_soumission   DateTime
  suivi_demande  SuiviDemande[]
}

model SuiviDemande {
  id          Int       @id @default(autoincrement())
  evenement   String
  date        DateTime  @default(now())
  demande     Demande   @relation(fields: [demandeId], references: [id])
  demandeId   Int
}

// USER, PROFIL ET SUIVI USER

model User {
id       Int      @id @default(autoincrement())
nom      String
email    String @unique
password String
role                String      @default("utilisateur")  // administrateur, utilisateur
date_inscription    DateTime @default(now())
profil_user Profil?
suivi_user  SuiviUser[]
}

model Profil {
  id             Int      @id @default(autoincrement())
  nom            String
  telephone      String   @unique
  avatar         String?
  bannere        String?
  adress         String?
  ville          String?
  date_adhesion  DateTime?
  date_expiration DateTime?
  status_adhesion String @default("inactif") // actif, inactif
  user           User     @relation(fields: [userId], references: [id])
  userId         Int      @unique
}

model SuiviUser {
id          Int       @id @default(autoincrement())
notifications   String
date        DateTime  @default(now())
user           User     @relation(fields: [userId], references: [id])
userId         Int  @unique
}


// NEWSLETTERS ET ABONNES

model NewsLetter {
  id          Int       @id @default(autoincrement())
  objet       String
  newsletter  String
  date        DateTime  @default(now())
}

model Abonnement {
  id          Int       @id @default(autoincrement())
  email    String
  date        DateTime  @default(now())
  confirmed Boolean @default(false)
}


// MESSAGE ET REPONSE

model Message {
  id          Int       @id @default(autoincrement())
  nom     String
  email    String
  objet    String
  message    String
  read    Boolean @default(false)
  confirmed Boolean @default(false)
  date        DateTime  @default(now())
  reponse Boolean @default(false)
  message_reponse MessageReponse?
}

model MessageReponse {
  id          Int       @id @default(autoincrement())
  objet     String
  reponse   String
  date        DateTime  @default(now())
  message     Message     @relation(fields: [messageId], references: [id])
  messageId         Int  @unique
}


// RAPPORT

model Rapport {
  id                  Int         @id @default(autoincrement())
  type                String      // adhésions, demandes, etc.
  date_generation     DateTime
  contenu             String
}